/*
paths = newArray("G:\\ALL_2P\\WF+2P\\M17\\001_loc1_1st2ndOrderCapAndPenetrator_preset5_z5_001.tif",
"G:\\ALL_2P\\WF+2P\\M17\\005_loc2_1stOrderCapAndPenetrator_preset5_z5_001.tif",
"G:\\ALL_2P\\WF+2P\\M17\\008_loc3_1st2ndOrderCapAndPenetrator_preset5_z5_001.tif",
"G:\\ALL_2P\\WF+2P\\M17\\010_loc4_1stOrderCapAndPenetrator_preset5_z5_001.tif",
"G:\\ALL_2P\\WF+2P\\M19\\001_loc1_1stOrderCapAndPenetrator(branch1)_preset5_z7_001.tif",
"G:\\ALL_2P\\WF+2P\\M19\\003_loc1_1stOrderCapAndPenetrator(branch2)_preset5_z7_001.tif",
"G:\\ALL_2P\\WF+2P\\M19\\005_loc2_1stOrderCapAndPenetrator_preset5_z5_001.tif",
"G:\\ALL_2P\\WF+2P\\M19\\008_loc3_1stOrderCapAndPenetrator_preset5_z6_001.tif",
"G:\\ALL_2P\\WF+2P\\M20\\001_loc1_1stOrderCapAndPenetrator_preset5_z_001.tif",
"G:\\ALL_2P\\WF+2P\\M20\\006_loc2_1stOrderCapAndPenetrator_preset5_z7_006.tif",
"G:\\ALL_2P\\WF+2P\\M21\\001_loc1_1stOrderCapAndPenetrator_preset5_z8_001.tif",
"G:\\ALL_2P\\WF+2P\\M21\\006_loc2_1stOrderCapAndPenetrator_preset5_z8_001.tif",
"G:\\ALL_2P\\WF+2P\\M21\\009_loc3_1stOrderCapAndPenetrator_preset5_z7_001.tif",
"G:\\ALL_2P\\WF+2P\\M21\\013_loc4_1stOrderCapAndPenetrator_preset5_z7_001.tif",
"G:\\ALL_2P\\WF+2P\\M22\\001_loc1_1stOrderCapAndPenetrator_preset5_z8_001.tif",
"G:\\ALL_2P\\WF+2P\\M22\\006_loc2_1stOrderCapAndPenetrator_preset5_z7_001.tif",
"G:\\ALL_2P\\WF+2P\\M22\\011_loc3_1stOrderCapAndPenetrator_preset5_z7_001.tif",
"G:\\ALL_2P\\WF+2P\\M22\\016_loc4_1stOrderCapAndPenetrator_preset5_z8_001.tif",
"G:\\ALL_2P\\WF+2P\\M23\\001_loc1_1stOrderCapAndPenetrator_preset5_z5_001.tif",
"G:\\ALL_2P\\WF+2P\\M25\\001_loc1_1stOrderCapAndPenetrator_preset5_z5_001.tif",
"G:\\ALL_2P\\WF+2P\\M25\\005_loc2_1stOrderCapAndPenetrator_preset5_z5_001.tif",
"G:\\ALL_2P\\WF+2P\\M25\\009_loc3_1stOrderCapAndPenetrator_preset5_z8_001.tif",
"G:\\ALL_2P\\WF+2P\\M25\\013_loc4_1stOrderCapAndPenetrator_preset5_z6_001.tif",
"G:\\ALL_2P\\WF+2P\\M26\\001_loc1_1stOrderCapAndPenetrator_preset5_z5_001.tif",
"G:\\ALL_2P\\WF+2P\\M28\\002_loc1_1st2ndOrderCap_preset5_z4_001.tif",
"G:\\ALL_2P\\WF+2P\\M28\\005_loc2_penetratorAnd1stOrderCap_preset5_z5_001.tif",
"G:\\ALL_2P\\WF+2P\\M28\\009_loc3_1stordercap_preset5_z5_001.tif",
"G:\\ALL_2P\\WF+2P\\M31\\001_loc0_1stordercap_preset5_z8_001.tif",
"G:\\ALL_2P\\WF+2P\\M31\\004_loc1_1stordercap_preset5_z8_001.tif",
"G:\\ALL_2P\\WF+2P\\M31\\006_loc2_1stordercap_preset5_z8_001.tif",
"G:\\ALL_2P\\WF+2P\\M31\\009_loc3_1stordercap_preset5_z8_001.tif",
"G:\\ALL_2P\\WF+2P\\M32\\001_loc0_1stordercap_preset5_z8_001.tif",
"G:\\ALL_2P\\WF+2P\\M32\\002_loc1_1stordercap_preset5_z4_001.tif",
"G:\\ALL_2P\\WF+2P\\M32\\005_loc2_1stordercap_preset5_z4_001.tif",
"G:\\ALL_2P\\WF+2P\\M33\\001_loc1_1stordercap_preset5_z6_001.tif",
"G:\\ALL_2P\\WF+2P\\M33\\007_loc2_1stordercap_preset5_z8_001.tif",
"G:\\ALL_2P\\WF+2P\\M33\\011_loc3-1_1stordercap_preset5_z6_001.tif",
"G:\\ALL_2P\\WF+2P\\M35\\001_loc1_preset5_z2_surface_001.tif",
"G:\\ALL_2P\\WF+2P\\M35\\006_loc1_preset5_z5_soma_001.tif",
"G:\\ALL_2P\\WF+2P\\M35\\012_loc2_preset5_z5_surface_001.tif",
"G:\\ALL_2P\\WF+2P\\M35\\010_loc2_preset5_z5_soma_001.tif",
"G:\\ALL_2P\\WF+2P\\M35\\014_loc3_preset5_z5_soma_001.tif",
"G:\\ALL_2P\\WF+2P\\M35\\017_loc4_preset5_z5_soma_002.tif",
"G:\\ALL_2P\\WF+2P\\M48\\001_loc1_preset5_z1o5_surface_001.tif",
"G:\\ALL_2P\\WF+2P\\M48\\016_loc1_preset5_z1o5_somas_001.tif",
"G:\\ALL_2P\\WF+2P\\M48\\004_loc2_preset5_z1o5_surface_001.tif",
"G:\\ALL_2P\\WF+2P\\M48\\007_loc3_preset5_z1o5_surface_001.tif",
"G:\\ALL_2P\\WF+2P\\M48\\022_loc3_preset5_z1o5_somas_001.tif",
"G:\\ALL_2P\\WF+2P\\M48\\010_loc4_preset5_z1o5_surface_001.tif",
"G:\\ALL_2P\\WF+2P\\M48\\013_loc5_preset5_z1o5_surface_001.tif",
"G:\\ALL_2P\\WF+2P\\M48\\019_loc6_preset5_z1o5_somas_001.tif",
"G:\\ALL_2P\\WF+2P\\M49\\001_loc1_preset5_z1o5_surface_001.tif",
"G:\\ALL_2P\\WF+2P\\M49\\004_loc2_preset5_z1o5_surface_001.tif",
"G:\\ALL_2P\\WF+2P\\M49\\007_loc3_preset5_z1o5_surface_001.tif",
"G:\\ALL_2P\\WF+2P\\M49\\010_loc4_preset5_z1o5_surface_001.tif");

folders = newArray("M17","M17","M17","M17","M19","M19","M19",
"M19","M20","M20","M21","M21","M21","M21","M22","M22",
"M22","M22","M23","M25","M25","M25","M25","M26","M28",
"M28","M28","M31","M31","M31","M31","M32","M32","M32",
"M33","M33","M33","M35","M35","M35","M35","M35","M35",
"M48","M48","M48","M48","M48","M48","M48","M48","M49",
"M49","M49","M49","END");

filenames = newArray("001_loc1_1st2ndOrderCapAndPenetrator_preset5_z5_001.tif",
"005_loc2_1stOrderCapAndPenetrator_preset5_z5_001.tif",
"008_loc3_1st2ndOrderCapAndPenetrator_preset5_z5_001.tif",
"010_loc4_1stOrderCapAndPenetrator_preset5_z5_001.tif",
"001_loc1_1stOrderCapAndPenetrator(branch1)_preset5_z7_001.tif",
"003_loc1_1stOrderCapAndPenetrator(branch2)_preset5_z7_001.tif",
"005_loc2_1stOrderCapAndPenetrator_preset5_z5_001.tif",
"008_loc3_1stOrderCapAndPenetrator_preset5_z6_001.tif",
"001_loc1_1stOrderCapAndPenetrator_preset5_z_001.tif",
"006_loc2_1stOrderCapAndPenetrator_preset5_z7_006.tif",
"001_loc1_1stOrderCapAndPenetrator_preset5_z8_001.tif",
"006_loc2_1stOrderCapAndPenetrator_preset5_z8_001.tif",
"009_loc3_1stOrderCapAndPenetrator_preset5_z7_001.tif",
"013_loc4_1stOrderCapAndPenetrator_preset5_z7_001.tif",
"001_loc1_1stOrderCapAndPenetrator_preset5_z8_001.tif",
"006_loc2_1stOrderCapAndPenetrator_preset5_z7_001.tif",
"011_loc3_1stOrderCapAndPenetrator_preset5_z7_001.tif",
"016_loc4_1stOrderCapAndPenetrator_preset5_z8_001.tif",
"001_loc1_1stOrderCapAndPenetrator_preset5_z5_001.tif",
"001_loc1_1stOrderCapAndPenetrator_preset5_z5_001.tif",
"005_loc2_1stOrderCapAndPenetrator_preset5_z5_001.tif",
"009_loc3_1stOrderCapAndPenetrator_preset5_z8_001.tif",
"013_loc4_1stOrderCapAndPenetrator_preset5_z6_001.tif",
"001_loc1_1stOrderCapAndPenetrator_preset5_z5_001.tif",
"002_loc1_1st2ndOrderCap_preset5_z4_001.tif",
"005_loc2_penetratorAnd1stOrderCap_preset5_z5_001.tif",
"009_loc3_1stordercap_preset5_z5_001.tif",
"001_loc0_1stordercap_preset5_z8_001.tif",
"004_loc1_1stordercap_preset5_z8_001.tif",
"006_loc2_1stordercap_preset5_z8_001.tif",
"009_loc3_1stordercap_preset5_z8_001.tif",
"001_loc0_1stordercap_preset5_z8_001.tif",
"002_loc1_1stordercap_preset5_z4_001.tif",
"005_loc2_1stordercap_preset5_z4_001.tif",
"001_loc1_1stordercap_preset5_z6_001.tif",
"007_loc2_1stordercap_preset5_z8_001.tif",
"011_loc3-1_1stordercap_preset5_z6_001.tif",
"001_loc1_preset5_z2_surface_001.tif",
"006_loc1_preset5_z5_soma_001.tif",
"012_loc2_preset5_z5_surface_001.tif",
"010_loc2_preset5_z5_soma_001.tif",
"014_loc3_preset5_z5_soma_001.tif",
"017_loc4_preset5_z5_soma_002.tif",
"001_loc1_preset5_z1o5_surface_001.tif",
"016_loc1_preset5_z1o5_somas_001.tif",
"004_loc2_preset5_z1o5_surface_001.tif",
"007_loc3_preset5_z1o5_surface_001.tif",
"022_loc3_preset5_z1o5_somas_001.tif",
"010_loc4_preset5_z1o5_surface_001.tif",
"013_loc5_preset5_z1o5_surface_001.tif",
"019_loc6_preset5_z1o5_somas_001.tif",
"001_loc1_preset5_z1o5_surface_001.tif",
"004_loc2_preset5_z1o5_surface_001.tif",
"007_loc3_preset5_z1o5_surface_001.tif",
"010_loc4_preset5_z1o5_surface_001.tif");

sinkDir = "G:\\ALL_2P\\WF+2P\\";
*/

paths = newArray("G:\\ALL_2P\\2P_Only\\M72\\001_loc1_256pix0o5ms7o81Hzz6_puffAt234fr_001.tif",
"G:\\ALL_2P\\2P_Only\\M72\\004_loc2_256pix0o5ms7o81Hzz6_puffAt234fr_001.tif",
"G:\\ALL_2P\\2P_Only\\M72\\006_loc3_256pix0o5ms7o81Hzz6_puffAt234fr_001.tif",
"G:\\ALL_2P\\2P_Only\\M72\\009_loc4_256pix0o5ms7o81Hzz9_puffAt234fr_001.tif");

folders = newArray("M72","M72","M72","M72");

filenames = newArray("001_loc1_256pix0o5ms7o81Hzz6_puffAt234fr_001.tif",
"004_loc2_256pix0o5ms7o81Hzz6_puffAt234fr_001.tif",
"006_loc3_256pix0o5ms7o81Hzz6_puffAt234fr_001.tif",
"009_loc4_256pix0o5ms7o81Hzz9_puffAt234fr_001.tif");

sinkDir = "G:\\ALL_2P\\2P_Only\\";

run("Close All");

for(i = 0; i < paths.length; i++){
	
	sourcePath = paths[i];
	folder = folders[i];
	filename = filenames[i];
	fileID = folder + "_" + substring(filename,4,8);

	if(File.exists(sourcePath)){
		print(sourcePath);
		open(sourcePath);
		run("Deinterleave", "how=2");
		selectWindow(filename + " #1");
		run("Green");
		rename(fileID + " - GREEN");
		selectWindow(fileID + " - GREEN");
		run("Z Project...", "projection=Median");
		selectWindow(fileID + " - GREEN");
		run("Z Project...", "projection=[Max Intensity]");
		selectWindow(filename + " #2");
		run("Red");
		rename(fileID + " - RED");
		selectWindow(fileID + " - RED");
		run("Z Project...", "projection=Median");
		selectWindow(fileID + " - RED");
		run("Z Project...", "projection=[Max Intensity]");

		titles = newArray(nImages());
  		for (j=1; j<=nImages(); j++) {
  			selectImage(j);
  			titles[j-1] = getTitle();
  		}
		for (k=1; k<titles.length; k++) {
			selectImage(k);
  			run("Enhance Contrast", "saturated=0.35");
  			// resetMinAndMax();
  		}
			
		run("Merge Channels...", "c1=["+fileID + " - GREEN"+"] c2=["+fileID + " - RED"+"] create");
		run("Duplicate...", "duplicate");
		run("Split Channels");
		imageCalculator("Subtract create stack", "C2-Composite-1","C1-Composite-1");
		selectWindow("C2-Composite-1");
		close();
		selectWindow("Result of C2-Composite-1");
		rename("C2-Composite-1");
		run("Enhance Contrast", "saturated=0.35");
			
		run("Tile");
		waitForUser;

		if (folder != folders[i+1]){
			savePath = sinkDir + folder + "\\";
			saveName = folder + "_ROIs.zip";
			roiManager("save", savePath + saveName);
			roiManager("reset");
		}
		run("Close All");
	}
}